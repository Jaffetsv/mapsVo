<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>B√∫squeda por Contrato</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  

</style>




</style>




</style>




</style>

    <style>
      body {
        font-family: 'Segoe UI', sans-serif;
        background: #d4eec9;
        margin: 0;
        padding: 0;
      }
      header {
        background: #d4eec9;
        color: #1d522f;
        padding: 1rem;
        text-align: center;
      }
      main {
        padding: 1rem;
      }
      #map {
        height: 500px;
        margin-top: 1rem;
      }
      input[type="text"], input[type="number"] {
        padding: 0.6rem 1rem;
        margin: 0.5rem;
        border: 2px solid #ccc;
        border-radius: 8px;
        font-size: 1rem;
        width: calc(100% - 2rem);
        max-width: 400px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      }
      .boton-principal {
        display: inline-block;
        font-weight: 600;
        font-size: 1rem;
        padding: 0.8rem 1.2rem;
        margin: 0.5rem 0.5rem 1rem;
        text-decoration: none;
        border-radius: 10px;
        transition: all 0.2s ease-in-out;
        box-shadow: 0 3px 6px rgba(0,0,0,0.1);
        border: 2px solid transparent;
      }
      .boton-principal:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.15);
      }
      .contrato-btn { background: #fff; border-color: #1a56db; color: #1a56db; }
      .placa-btn { background: #fff; border-color: #19703a; color: #19703a; }
      .ubicacion-btn { background: #1a56db; border-color: #1a56db; color: #fff; }
      .limpiar-btn { background: #ffffff; border-color: #ccc; color: #444; }
      .volver-btn {
        display: inline-block;
        margin-bottom: 1rem;
        padding: 0.8rem 1.2rem;
        background: #19703a;
        color: #fff;
        text-decoration: none;
        border-radius: 10px;
        font-weight: 600;
        transition: all 0.2s ease-in-out;
        box-shadow: 0 3px 6px rgba(0,0,0,0.1);
      }
      .volver-btn:hover {
        background: #145d30;
        transform: translateY(-1px);
      }
      .acciones {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 0.75rem;
        margin-bottom: 1rem;
      }
    </style>
    
</head>
<body>
<div style="background:#d4eec9;text-align:center;"><img src="logo.png" alt="DELSUR MAPS" style="height:190px;margin:1rem auto;"></div>

  <header>
    <h1>B√∫squeda por Contrato</h1>
  </header>
  <main>
    <a class="volver-btn" href="index.html">‚¨Ö Volver al inicio</a>
    <div class="acciones"><input type="text" id="inputValor" placeholder="Ingrese el contrato" onkeypress="if(event.key==='Enter'){buscar()}">
<button class="boton-principal contrato-btn" onclick="buscar()">üîé Buscar</button><button class="boton-principal limpiar-btn" onclick="limpiar()">üßπ Limpiar</button></div>
    <div class="result" id="result"></div>
    <div id="map"></div>
  </main>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js">
function limpiar() {
  document.getElementById('inputValor').value = '';
  document.getElementById('result').innerHTML = '';
  if (typeof markerLayer !== 'undefined') {
    markerLayer.clearLayers();
  }
}

</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js">
function limpiar() {
  document.getElementById('inputValor').value = '';
  document.getElementById('result').innerHTML = '';
  if (typeof markerLayer !== 'undefined') {
    markerLayer.clearLayers();
  }
}

</script>
  <script>
    let map = L.map('map').setView([13.7, -89.2], 8);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 18 }).addTo(map);
    let markerLayer = L.layerGroup().addTo(map);

    let datos = [];

    async function cargarDatos() {
      const response = await fetch('data.xlsx');
      const data = await response.arrayBuffer();
      const workbook = XLSX.read(data);
      const hoja = XLSX.utils.sheet_to_json(workbook.Sheets['Contratos']);
      datos = hoja.map(row => {
        return {
          clave: (row['REFERENCIA'] || row['Contrato']).toString().trim(),
          nombre: row['Referencia'] || row['REFERENCIA'],
          lat: row['Latitud'],
          lon: row['Longitud'] || row['Longuitud'],
          alimentador: row['Alimentador'] || 'N/D'
        };
      });
    }

    function mostrarResultado(nombre, lat, lon, alimentador) {
      const popup = `<b>${nombre}</b><br>${lat}, ${lon}<br>${alimentador}<br>
        <a href='https://www.google.com/maps?q=${lat},${lon}' target='_blank'>üìç Ver en Google Maps</a>`;
      L.marker([lat, lon]).addTo(markerLayer).bindPopup(popup).openPopup();
      map.setView([lat, lon], 16);
      document.getElementById("result").innerHTML = popup;
    }

    
function mostrarResultado(nombre, lat, lon, alimentador) {
  const gmaps = `https://www.google.com/maps?q=${lat},${lon}`;
  const waze = `https://waze.com/ul?ll=${lat},${lon}&navigate=yes`;
  const popup = `<b>${nombre}</b><br>${lat}, ${lon}<br>${alimentador}<br>
    <a href='${gmaps}' target='_blank'>üìç Google Maps</a> | 
    <a href='${waze}' target='_blank'>üöó Waze</a>`;
  L.marker([lat, lon]).addTo(markerLayer).bindPopup(popup).openPopup();
  map.setView([lat, lon], 16);
  document.getElementById("result").innerHTML = popup;
}

function buscar() {
  const valor = document.getElementById('inputValor').value.trim().toLowerCase();
  const encontrado = datos.find(d => d.clave.toLowerCase() === valor);
  markerLayer.clearLayers();
  if (encontrado) {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(pos => {
        const lat = pos.coords.latitude;
        const lon = pos.coords.longitude;
        L.marker([lat, lon], {
          icon: L.icon({
            iconUrl: 'https://maps.gstatic.com/mapfiles/ms2/micons/blue-dot.png',
            iconSize: [30, 30],
            iconAnchor: [15, 30]
          })
        }).addTo(markerLayer).bindPopup("Tu ubicaci√≥n");
      });
    }
    mostrarResultado(encontrado.nombre, encontrado.lat, encontrado.lon, encontrado.alimentador);
  } else {
    alert("No se encontr√≥ la contrato.");
  }
}

    cargarDatos();
  
function limpiar() {
  document.getElementById('inputValor').value = '';
  document.getElementById('result').innerHTML = '';
  if (typeof markerLayer !== 'undefined') {
    markerLayer.clearLayers();
  }
}

</script>
</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Shifter Clone - Personalizado</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { background-color: #1a1c23; color: white; font-family: sans-serif; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background-color: #444; }
        
        /* Celda base: Siempre blanca por defecto */
        .day-cell { background-color: #ffffff; height: 110px; position: relative; color: #333; cursor: pointer; display: flex; flex-direction: column; border: 0.5px solid #eee; }
        .day-number { font-size: 11px; font-weight: bold; padding: 2px 4px; position: absolute; top: 0; right: 0; z-index: 10; color: #666; }

        /* Colores dinámicos basados en clases */
        .bg-Mañana { background-color: #ffff00 !important; }
        .bg-Tarde { background-color: #fbcfe8 !important; }
        .bg-Cena { background-color: #d8b4fe !important; } /* Púrpura para Cena/Noche */
        .bg-16HRS { background-color: #bef264 !important; } /* Verde Lima */
        .bg-Libre { background-color: #ffffff !important; }
        .bg-Vacaciones { background-color: #fed7aa !important; }

        /* Turno Mixto (Dividido) */
        .split-top { height: 50%; width: 100%; border-bottom: 1px solid rgba(0,0,0,0.05); }
        .split-bottom { height: 50%; width: 100%; }

        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.85); align-items: center; justify-content: center; z-index: 100; padding: 15px; }
        .modal.active { display: flex; }
        .btn-turno { width: 100%; padding: 10px; border-radius: 8px; font-weight: bold; margin-bottom: 6px; text-align: center; color: #1f2937; font-size: 13px; cursor: pointer; border: 2px solid transparent; }
        .selected { border-color: #ef4444 !important; transform: scale(1.02); }
    </style>
</head>
<body>

    <div class="flex items-center justify-between p-4 bg-[#2d333b] border-b border-gray-700">
        <button onclick="changeMonth(-1)" class="text-xl px-4">❮</button>
        <div class="text-center">
            <h1 id="monthTitle" class="text-lg font-bold uppercase tracking-wider">MES 2026</h1>
            <button onclick="openConfig()" class="text-[10px] text-cyan-400 underline uppercase">Configurar Nombres/Horas</button>
        </div>
        <button onclick="changeMonth(1)" class="text-xl px-4">❯</button>
    </div>

    <div class="grid grid-cols-7 text-center text-[10px] font-bold py-2 bg-[#2d333b] text-gray-400">
        <div>DOM</div><div>LUN</div><div>MAR</div><div>MIÉ</div><div>JUE</div><div>VIE</div><div>SÁB</div>
    </div>

    <div id="calendar" class="calendar-grid"></div>

    <div id="modalDia" class="modal">
        <div class="bg-[#1c2128] w-full max-w-sm rounded-xl overflow-hidden shadow-2xl border border-gray-700">
            <div class="bg-red-600 text-white text-center py-2 font-bold text-sm uppercase">Añadir Turno - <span id="fechaLabel"></span></div>
            <div class="p-4">
                <div id="listaBotones"></div> <textarea id="notaInput" placeholder="Notas (ej. CENA, CITA)..." class="w-full mt-4 p-2 bg-[#2d333b] border border-gray-600 rounded text-white text-sm h-16"></textarea>
                <div class="flex gap-2 mt-4">
                    <button onclick="closeModals()" class="flex-1 p-3 bg-gray-600 rounded-full font-bold text-xs uppercase">Cancelar</button>
                    <button onclick="guardarCambio()" class="flex-1 p-3 bg-emerald-500 text-emerald-950 rounded-full font-bold text-xs uppercase text-center">Aceptar</button>
                </div>
            </div>
        </div>
    </div>

    <div id="modalConfig" class="modal">
        <div class="bg-[#1c2128] w-full max-w-sm rounded-xl p-4 border border-gray-700">
            <h2 class="text-center font-bold mb-4 text-cyan-400">PERSONALIZAR TURNOS</h2>
            <div id="configForm" class="space-y-3 overflow-y-auto max-h-[60vh] p-1"></div>
            <button onclick="saveConfig()" class="w-full mt-4 p-3 bg-cyan-600 rounded-lg font-bold uppercase">Guardar Configuración</button>
        </div>
    </div>

    <script>
        // Configuración inicial de turnos
        let configTurnos = JSON.parse(localStorage.getItem('conf_shifter')) || {
            'Mañana': { nombre: 'Mañana', horas: '8:00 a.m. - 2:00 p.m.', color: 'Mañana' },
            'Tarde': { nombre: 'Tarde', horas: '2:00 p.m. - 9:00 p.m.', color: 'Tarde' },
            'Cena': { nombre: 'Cena', horas: '9:00 p.m. - 7:00 a.m.', color: 'Cena' },
            '16HRS': { nombre: '16 HRS', horas: 'Todo el día', color: '16HRS' },
            'Mixto': { nombre: 'Mañana / Tarde', horas: 'Turno Doble', color: 'Mixto' },
            'Libre': { nombre: 'Libre', horas: '', color: 'Libre' }
        };

        let db = JSON.parse(localStorage.getItem('datos_shifter')) || {};
        let fechaActual = new Date();
        let diaSeleccionado = "";
        let tipoSeleccionado = "";

        function render() {
            const container = document.getElementById('calendar');
            container.innerHTML = '';
            const y = fechaActual.getFullYear(), m = fechaActual.getMonth();
            document.getElementById('monthTitle').innerText = new Intl.DateTimeFormat('es-ES', { month: 'long', year: 'numeric' }).format(fechaActual);

            const start = new Date(y, m, 1).getDay();
            const days = new Date(y, m + 1, 0).getDate();

            for(let i=0; i<start; i++) container.innerHTML += `<div class="day-cell opacity-20"></div>`;

            for(let d=1; d<=days; d++) {
                const key = `${y}-${m+1}-${d}`;
                const info = db[key] || { tipo: 'Libre', notas: '' };
                const conf = configTurnos[info.tipo] || configTurnos['Libre'];
                
                const cell = document.createElement('div');
                cell.className = `day-cell`;
                
                if(info.tipo === 'Mixto') {
                    cell.innerHTML = `<div class="split-top bg-Mañana"></div><div class="split-bottom bg-Tarde"></div>`;
                } else {
                    cell.classList.add('bg-' + conf.color);
                }

                cell.innerHTML += `
                    <span class="day-number">${d}</span>
                    <div class="flex-1 flex flex-col items-center justify-center p-1 text-center">
                        <span class="text-[10px] font-extrabold uppercase">${conf.nombre}</span>
                        <span class="text-[8px] font-bold text-gray-700 mt-1 leading-tight">${info.notas || ''}</span>
                    </div>
                `;
                cell.onclick = () => abrirEdicion(key, info);
                container.appendChild(cell);
            }
        }

        function abrirEdicion(key, info) {
            diaSeleccionado = key;
            tipoSeleccionado = info.tipo;
            document.getElementById('fechaLabel').innerText = key;
            document.getElementById('notaInput').value = info.notas;
            
            const lista = document.getElementById('listaBotones');
            lista.innerHTML = '';
            Object.keys(configTurnos).forEach(id => {
                const c = configTurnos[id];
                const btn = document.createElement('div');
                btn.className = `btn-turno bg-${c.color} ${tipoSeleccionado === id ? 'selected' : ''}`;
                btn.innerHTML = `${c.nombre} <br> <span class="text-[9px] font-normal">${c.horas}</span>`;
                btn.onclick = () => {
                    tipoSeleccionado = id;
                    abrirEdicion(key, {tipo: id, notas: document.getElementById('notaInput').value});
                };
                lista.appendChild(btn);
            });
            document.getElementById('modalDia').classList.add('active');
        }

        function guardarCambio() {
            db[diaSeleccionado] = { tipo: tipoSeleccionado, notas: document.getElementById('notaInput').value };
            localStorage.setItem('datos_shifter', JSON.stringify(db));
            render();
            closeModals();
            alert("¡Cambio guardado localmente!");
        }

        function openConfig() {
            const form = document.getElementById('configForm');
            form.innerHTML = '';
            Object.keys(configTurnos).forEach(id => {
                form.innerHTML += `
                    <div class="p-2 border border-gray-600 rounded bg-gray-800">
                        <label class="text-[10px] text-gray-400">ID: ${id}</label>
                        <input id="name-${id}" type="text" value="${configTurnos[id].nombre}" class="w-full bg-transparent border-b border-gray-500 mb-1 text-sm">
                        <input id="hour-${id}" type="text" value="${configTurnos[id].horas}" class="w-full bg-transparent text-[10px] text-cyan-200">
                    </div>
                `;
            });
            document.getElementById('modalConfig').classList.add('active');
        }

        function saveConfig() {
            Object.keys(configTurnos).forEach(id => {
                configTurnos[id].nombre = document.getElementById(`name-${id}`).value;
                configTurnos[id].horas = document.getElementById(`hour-${id}`).value;
            });
            localStorage.setItem('conf_shifter', JSON.stringify(configTurnos));
            render();
            closeModals();
        }

        function closeModals() { 
            document.getElementById('modalDia').classList.remove('active'); 
            document.getElementById('modalConfig').classList.remove('active'); 
        }
        function changeMonth(v) { fechaActual.setMonth(fechaActual.getMonth() + v); render(); }

        render();
    </script>
</body>
</html>
